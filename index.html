<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PaperMind — Research Paper Learning Tool</title>
  <meta name="description" content="Transform research papers into summaries, flashcards, quizzes, audio, and presentation decks." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-primary: #0d0d0b;
      --bg-secondary: #1a1a17;
      --bg-card: #232320;
      --text-primary: #f5f3ef;
      --text-secondary: #a8a59d;
      --accent: #e8c547;
      --accent-dim: #b89a2f;
      --success: #4a9f4a;
      --error: #c44;
      --border: #333330;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      background-image: 
        radial-gradient(ellipse at 20% 0%, rgba(232, 197, 71, 0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(232, 197, 71, 0.02) 0%, transparent 50%);
    }

    #root { min-height: 100vh; }

    .serif { font-family: 'Instrument Serif', Georgia, serif; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .mermaid { background: transparent !important; }
    .mermaid svg { max-width: 100%; height: auto; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // Initialize libraries
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    mermaid.initialize({ startOnLoad: false, theme: 'dark', themeVariables: { primaryColor: '#e8c547', primaryTextColor: '#0d0d0b', primaryBorderColor: '#e8c547', lineColor: '#a8a59d', secondaryColor: '#232320', tertiaryColor: '#1a1a17' }});

    // ============ ICONS ============
    const Icons = {
      Upload: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
      FileText: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
      Play: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
      Pause: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
      Cards: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>,
      Slides: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>,
      Key: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>,
      Check: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ChevronLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
      ChevronRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
      Download: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      Brain: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
      Link: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>,
    };

    // ============ API KEY INPUT ============
    function ApiKeyInput({ apiKey, setApiKey }) {
      const [showKey, setShowKey] = useState(false);
      const [saved, setSaved] = useState(false);

      const handleSave = () => {
        localStorage.setItem('gemini_api_key', apiKey);
        setSaved(true);
        setTimeout(() => setSaved(false), 2000);
      };

      return (
        <div style={{ background: 'var(--bg-card)', borderRadius: '12px', padding: '20px', border: '1px solid var(--border)', marginBottom: '24px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>
            <Icons.Key />
            <span style={{ fontWeight: '600' }}>Gemini API Key</span>
          </div>
          <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
            <input
              type={showKey ? 'text' : 'password'}
              value={apiKey}
              onChange={(e) => setApiKey(e.target.value)}
              placeholder="Enter your Gemini API key..."
              style={{ flex: '1 1 200px', background: 'var(--bg-secondary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '12px 16px', color: 'var(--text-primary)', fontSize: '14px', outline: 'none' }}
            />
            <button onClick={() => setShowKey(!showKey)} style={{ background: 'var(--bg-secondary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '12px 16px', color: 'var(--text-secondary)', cursor: 'pointer', fontSize: '13px' }}>
              {showKey ? 'Hide' : 'Show'}
            </button>
            <button onClick={handleSave} style={{ background: saved ? 'var(--success)' : 'var(--accent)', border: 'none', borderRadius: '8px', padding: '12px 20px', color: 'var(--bg-primary)', cursor: 'pointer', fontWeight: '600', fontSize: '14px', display: 'flex', alignItems: 'center', gap: '6px' }}>
              {saved ? <><Icons.Check /> Saved</> : 'Save'}
            </button>
          </div>
          <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '10px' }}>
            Get your free API key at <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener" style={{ color: 'var(--accent)' }}>aistudio.google.com</a>
          </p>
        </div>
      );
    }

    // ============ FILE UPLOAD ============
    function FileUpload({ onFileSelect, onArxivSubmit, isProcessing }) {
      const fileInputRef = useRef(null);
      const [dragOver, setDragOver] = useState(false);
      const [arxivUrl, setArxivUrl] = useState('');
      const [mode, setMode] = useState('upload');

      const handleDrop = (e) => {
        e.preventDefault();
        setDragOver(false);
        const file = e.dataTransfer.files[0];
        if (file && file.type === 'application/pdf') onFileSelect(file);
      };

      const handleArxivSubmit = () => {
        if (arxivUrl.includes('arxiv.org')) onArxivSubmit(arxivUrl);
      };

      return (
        <div style={{ marginBottom: '24px' }}>
          <div style={{ display: 'flex', gap: '8px', marginBottom: '16px' }}>
            <button onClick={() => setMode('upload')} style={{ flex: 1, padding: '10px', background: mode === 'upload' ? 'var(--bg-card)' : 'transparent', border: '1px solid var(--border)', borderRadius: '8px', color: mode === 'upload' ? 'var(--text-primary)' : 'var(--text-secondary)', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
              <Icons.Upload /> Upload PDF
            </button>
            <button onClick={() => setMode('arxiv')} style={{ flex: 1, padding: '10px', background: mode === 'arxiv' ? 'var(--bg-card)' : 'transparent', border: '1px solid var(--border)', borderRadius: '8px', color: mode === 'arxiv' ? 'var(--text-primary)' : 'var(--text-secondary)', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
              <Icons.Link /> arXiv Link
            </button>
          </div>

          {mode === 'upload' ? (
            <div
              onClick={() => !isProcessing && fileInputRef.current?.click()}
              onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
              onDragLeave={() => setDragOver(false)}
              onDrop={handleDrop}
              style={{ border: `2px dashed ${dragOver ? 'var(--accent)' : 'var(--border)'}`, borderRadius: '16px', padding: '48px', textAlign: 'center', cursor: isProcessing ? 'not-allowed' : 'pointer', transition: 'all 0.3s', background: dragOver ? 'rgba(232, 197, 71, 0.05)' : 'transparent', opacity: isProcessing ? 0.5 : 1 }}
            >
              <input ref={fileInputRef} type="file" accept=".pdf" onChange={(e) => e.target.files[0] && onFileSelect(e.target.files[0])} style={{ display: 'none' }} />
              <div style={{ width: '64px', height: '64px', background: 'var(--bg-card)', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 20px', border: '1px solid var(--border)' }}>
                <Icons.Upload />
              </div>
              <p className="serif" style={{ fontSize: '20px', marginBottom: '8px' }}>Drop your research paper here</p>
              <p style={{ color: 'var(--text-secondary)', fontSize: '14px' }}>or click to browse • PDF files only</p>
            </div>
          ) : (
            <div style={{ background: 'var(--bg-card)', borderRadius: '16px', padding: '32px', border: '1px solid var(--border)' }}>
              <p style={{ marginBottom: '16px', color: 'var(--text-secondary)' }}>Paste an arXiv URL (e.g., https://arxiv.org/abs/1706.03762)</p>
              <div style={{ display: 'flex', gap: '10px' }}>
                <input
                  type="url"
                  value={arxivUrl}
                  onChange={(e) => setArxivUrl(e.target.value)}
                  placeholder="https://arxiv.org/abs/..."
                  style={{ flex: 1, background: 'var(--bg-secondary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '14px 16px', color: 'var(--text-primary)', fontSize: '14px', outline: 'none' }}
                />
                <button onClick={handleArxivSubmit} disabled={isProcessing || !arxivUrl.includes('arxiv')} style={{ background: 'var(--accent)', border: 'none', borderRadius: '8px', padding: '14px 24px', color: 'var(--bg-primary)', cursor: 'pointer', fontWeight: '600', opacity: isProcessing || !arxivUrl.includes('arxiv') ? 0.5 : 1 }}>
                  Fetch Paper
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ============ PROCESSING STATUS ============
    function ProcessingStatus({ status }) {
      return (
        <div style={{ background: 'var(--bg-card)', borderRadius: '12px', padding: '24px', marginBottom: '24px', border: '1px solid var(--border)', animation: 'fadeIn 0.3s ease' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
            <div style={{ width: '24px', height: '24px', borderRadius: '50%', border: '2px solid var(--accent)', borderTopColor: 'transparent', animation: 'spin 1s linear infinite' }} />
            <span style={{ color: 'var(--text-secondary)' }}>{status}</span>
          </div>
        </div>
      );
    }

    // ============ TAB NAVIGATION ============
    function TabNav({ activeTab, setActiveTab, tabs }) {
      return (
        <div style={{ display: 'flex', gap: '4px', background: 'var(--bg-secondary)', padding: '4px', borderRadius: '12px', marginBottom: '24px', flexWrap: 'wrap' }}>
          {tabs.map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              style={{ flex: '1 1 auto', minWidth: '80px', padding: '12px 16px', background: activeTab === tab.id ? 'var(--bg-card)' : 'transparent', border: 'none', borderRadius: '8px', color: activeTab === tab.id ? 'var(--text-primary)' : 'var(--text-secondary)', cursor: 'pointer', fontSize: '14px', fontWeight: activeTab === tab.id ? '600' : '400', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', transition: 'all 0.2s' }}
            >
              {tab.icon}
              <span style={{ display: 'inline' }}>{tab.label}</span>
            </button>
          ))}
        </div>
      );
    }

    // ============ SUMMARY COMPONENT ============
    function Summary({ content }) {
      return (
        <div style={{ animation: 'fadeIn 0.4s ease' }}>
          <h3 className="serif" style={{ fontSize: '24px', marginBottom: '16px', color: 'var(--accent)' }}>Summary</h3>
          <div style={{ background: 'var(--bg-card)', borderRadius: '12px', padding: '24px', border: '1px solid var(--border)', lineHeight: '1.8', color: 'var(--text-secondary)', whiteSpace: 'pre-wrap' }}>
            {content}
          </div>
        </div>
      );
    }

    // ============ FLASHCARDS + QUIZ ============
    function Flashcards({ cards }) {
      const [currentIndex, setCurrentIndex] = useState(0);
      const [flipped, setFlipped] = useState(false);
      const [quizMode, setQuizMode] = useState(false);
      const [score, setScore] = useState(0);
      const [answered, setAnswered] = useState(false);
      const [showAnswer, setShowAnswer] = useState(false);

      const nextCard = () => {
        setFlipped(false);
        setAnswered(false);
        setShowAnswer(false);
        setCurrentIndex((i) => (i + 1) % cards.length);
      };

      const prevCard = () => {
        setFlipped(false);
        setAnswered(false);
        setShowAnswer(false);
        setCurrentIndex((i) => (i - 1 + cards.length) % cards.length);
      };

      const handleQuizAnswer = (correct) => {
        if (!answered) {
          setAnswered(true);
          setShowAnswer(true);
          if (correct) setScore(s => s + 1);
        }
      };

      const resetQuiz = () => {
        setCurrentIndex(0);
        setScore(0);
        setAnswered(false);
        setShowAnswer(false);
      };

      const card = cards[currentIndex];
      const isLastCard = currentIndex === cards.length - 1;

      return (
        <div style={{ animation: 'fadeIn 0.4s ease' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px', flexWrap: 'wrap', gap: '12px' }}>
            <h3 className="serif" style={{ fontSize: '24px', color: 'var(--accent)' }}>
              {quizMode ? 'Quiz Mode' : 'Flashcards'}
            </h3>
            <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
              {quizMode && <span style={{ color: 'var(--accent)', fontWeight: '600' }}>Score: {score}/{currentIndex + (answered ? 1 : 0)}</span>}
              <span style={{ color: 'var(--text-secondary)', fontSize: '14px' }}>{currentIndex + 1} / {cards.length}</span>
              <button onClick={() => { setQuizMode(!quizMode); resetQuiz(); }} style={{ background: quizMode ? 'var(--accent)' : 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '8px', padding: '8px 16px', color: quizMode ? 'var(--bg-primary)' : 'var(--text-primary)', cursor: 'pointer', fontSize: '13px', fontWeight: '600' }}>
                {quizMode ? 'Exit Quiz' : 'Start Quiz'}
              </button>
            </div>
          </div>
          
          <div
            onClick={() => !quizMode && setFlipped(!flipped)}
            style={{ background: 'var(--bg-card)', borderRadius: '16px', padding: '48px 32px', border: '1px solid var(--border)', minHeight: '250px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', cursor: quizMode ? 'default' : 'pointer', position: 'relative' }}
          >
            <div style={{ textAlign: 'center', width: '100%' }}>
              <div style={{ fontSize: '10px', textTransform: 'uppercase', letterSpacing: '2px', color: 'var(--accent)', marginBottom: '16px' }}>
                {quizMode ? 'Question' : (flipped ? 'Answer' : 'Question')}
              </div>
              <p style={{ fontSize: '18px', lineHeight: '1.6', color: 'var(--text-primary)', marginBottom: quizMode ? '24px' : 0 }}>
                {card.question}
              </p>
              
              {quizMode && (
                <>
                  {showAnswer && (
                    <div style={{ marginTop: '20px', padding: '16px', background: 'var(--bg-secondary)', borderRadius: '8px', border: '1px solid var(--border)' }}>
                      <p style={{ fontSize: '14px', color: 'var(--text-secondary)' }}><strong style={{ color: 'var(--accent)' }}>Answer:</strong> {card.answer}</p>
                    </div>
                  )}
                  {!answered && (
                    <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', marginTop: '24px' }}>
                      <button onClick={() => setShowAnswer(true)} style={{ background: 'var(--bg-secondary)', border: '1px solid var(--border)', borderRadius: '8px', padding: '12px 24px', color: 'var(--text-primary)', cursor: 'pointer' }}>
                        Show Answer
                      </button>
                    </div>
                  )}
                  {showAnswer && !answered && (
                    <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', marginTop: '16px' }}>
                      <button onClick={() => handleQuizAnswer(true)} style={{ background: 'var(--success)', border: 'none', borderRadius: '8px', padding: '12px 24px', color: 'white', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px', fontWeight: '600' }}>
                        <Icons.Check /> I knew it
                      </button>
                      <button onClick={() => handleQuizAnswer(false)} style={{ background: 'var(--error)', border: 'none', borderRadius: '8px', padding: '12px 24px', color: 'white', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px', fontWeight: '600' }}>
                        <Icons.X /> Didn't know
                      </button>
                    </div>
                  )}
                </>
              )}
              
              {!quizMode && flipped && (
                <p style={{ fontSize: '16px', lineHeight: '1.6', color: 'var(--text-secondary)', marginTop: '20px', paddingTop: '20px', borderTop: '1px solid var(--border)' }}>
                  {card.answer}
                </p>
              )}
            </div>
            
            {!quizMode && (
              <div style={{ position: 'absolute', bottom: '16px', right: '16px', fontSize: '12px', color: 'var(--text-secondary)', opacity: 0.5 }}>
                Click to flip
              </div>
            )}
          </div>

          <div style={{ display: 'flex', justifyContent: 'center', gap: '12px', marginTop: '20px' }}>
            <button onClick={prevCard} style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '8px', padding: '12px 24px', color: 'var(--text-primary)', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px' }}>
              <Icons.ChevronLeft /> Previous
            </button>
            {quizMode && isLastCard && answered ? (
              <button onClick={resetQuiz} style={{ background: 'var(--accent)', border: 'none', borderRadius: '8px', padding: '12px 24px', color: 'var(--bg-primary)', cursor: 'pointer', fontWeight: '600' }}>
                Restart Quiz ({score}/{cards.length})
              </button>
            ) : (
              <button onClick={nextCard} disabled={quizMode && !answered} style={{ background: 'var(--accent)', border: 'none', borderRadius: '8px', padding: '12px 24px', color: 'var(--bg-primary)', cursor: 'pointer', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '6px', opacity: quizMode && !answered ? 0.5 : 1 }}>
                Next <Icons.ChevronRight />
              </button>
            )}
          </div>
        </div>
      );
    }

    // ============ AUDIO PLAYER ============
    function AudioPlayer({ text, title }) {
      const [isPlaying, setIsPlaying] = useState(false);
      const [progress, setProgress] = useState(0);
      const utteranceRef = useRef(null);
      const intervalRef = useRef(null);

      const togglePlay = () => {
        if (isPlaying) {
          speechSynthesis.cancel();
          clearInterval(intervalRef.current);
          setIsPlaying(false);
        } else {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = 0.9;
          utterance.pitch = 1;
          
          const voices = speechSynthesis.getVoices();
          const preferredVoice = voices.find(v => v.name.includes('Google') || v.name.includes('Samantha') || v.name.includes('Daniel'));
          if (preferredVoice) utterance.voice = preferredVoice;

          utterance.onend = () => {
            setIsPlaying(false);
            setProgress(100);
            clearInterval(intervalRef.current);
          };

          let charIndex = 0;
          utterance.onboundary = (e) => {
            charIndex = e.charIndex;
            setProgress((charIndex / text.length) * 100);
          };

          utteranceRef.current = utterance;
          speechSynthesis.speak(utterance);
          setIsPlaying(true);
        }
      };

      useEffect(() => {
        return () => {
          speechSynthesis.cancel();
          clearInterval(intervalRef.current);
        };
      }, []);

      const duration = Math.ceil(text.split(' ').length / 150);

      return (
        <div style={{ animation: 'fadeIn 0.4s ease' }}>
          <h3 className="serif" style={{ fontSize: '24px', marginBottom: '16px', color: 'var(--accent)' }}>Audio Summary</h3>
          <div style={{ background: 'var(--bg-card)', borderRadius: '16px', padding: '32px', border: '1px solid var(--border)' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '20px', marginBottom: '20px' }}>
              <button
                onClick={togglePlay}
                style={{ width: '64px', height: '64px', borderRadius: '50%', background: 'var(--accent)', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--bg-primary)', transition: 'transform 0.2s', flexShrink: 0 }}
              >
                {isPlaying ? <Icons.Pause /> : <Icons.Play />}
              </button>
              <div style={{ flex: 1, minWidth: 0 }}>
                <p style={{ fontWeight: '600', marginBottom: '4px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{title}</p>
                <p style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                  Audio summary • ~{duration} min
                </p>
              </div>
            </div>
            <div style={{ height: '6px', background: 'var(--bg-secondary)', borderRadius: '3px', overflow: 'hidden' }}>
              <div style={{ height: '100%', width: `${progress}%`, background: 'var(--accent)', borderRadius: '3px', transition: 'width 0.1s linear' }} />
            </div>
            <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '16px', fontStyle: 'italic' }}>
              Uses your browser's text-to-speech engine
            </p>
          </div>
        </div>
      );
    }

    // ============ ENHANCED DECK ============
    function EnhancedDeck({ slides, title, diagram, stats }) {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [showNotes, setShowNotes] = useState(false);
      const mermaidRef = useRef(null);

      useEffect(() => {
        if (mermaidRef.current && diagram) {
          mermaidRef.current.innerHTML = diagram;
          mermaid.run({ nodes: [mermaidRef.current] });
        }
      }, [diagram, currentSlide]);

      const downloadPptx = async () => {
        const pptx = new PptxGenJS();
        pptx.author = 'PaperMind';
        pptx.title = title;
        pptx.subject = 'Research Paper Summary';

        // Title slide
        let slide = pptx.addSlide();
        slide.addText(title, { x: 0.5, y: 2, w: 9, h: 1.5, fontSize: 36, bold: true, color: 'E8C547', fontFace: 'Georgia' });
        slide.addText('Generated by PaperMind', { x: 0.5, y: 4, w: 9, fontSize: 14, color: 'A8A59D' });
        slide.background = { color: '0D0D0B' };

        // Content slides
        slides.forEach((s, i) => {
          slide = pptx.addSlide();
          slide.background = { color: '0D0D0B' };
          
          // Slide number
          slide.addText(`${i + 1}`, { x: 9, y: 0.3, w: 0.5, fontSize: 10, color: 'A8A59D' });
          
          // Title
          slide.addText(s.title, { x: 0.5, y: 0.5, w: 9, h: 0.8, fontSize: 28, bold: true, color: 'E8C547', fontFace: 'Georgia' });
          
          // Points
          const points = s.points.map(p => ({ text: p, options: { bullet: { type: 'bullet', color: 'E8C547' }, color: 'F5F3EF', fontSize: 16, breakLine: true } }));
          slide.addText(points, { x: 0.5, y: 1.5, w: 9, h: 3.5, valign: 'top', fontFace: 'Arial' });

          // Stats callout if present
          if (s.stat) {
            slide.addShape(pptx.ShapeType.roundRect, { x: 0.5, y: 5, w: 3, h: 0.8, fill: { color: '232320' }, line: { color: 'E8C547', pt: 1 } });
            slide.addText(s.stat, { x: 0.5, y: 5, w: 3, h: 0.8, fontSize: 14, color: 'E8C547', bold: true, align: 'center', valign: 'middle' });
          }

          // Speaker notes
          if (s.notes) {
            slide.addNotes(s.notes);
          }
        });

        await pptx.writeFile({ fileName: `${title.replace(/[^a-z0-9]/gi, '_')}_deck.pptx` });
      };

      const slide = slides[currentSlide];

      return (
        <div style={{ animation: 'fadeIn 0.4s ease' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px', flexWrap: 'wrap', gap: '12px' }}>
            <h3 className="serif" style={{ fontSize: '24px', color: 'var(--accent)' }}>Learning Deck</h3>
            <div style={{ display: 'flex', gap: '8px' }}>
              <button onClick={() => setShowNotes(!showNotes)} style={{ background: showNotes ? 'var(--accent)' : 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '8px', padding: '8px 16px', color: showNotes ? 'var(--bg-primary)' : 'var(--text-primary)', cursor: 'pointer', fontSize: '13px' }}>
                {showNotes ? 'Hide Notes' : 'Speaker Notes'}
              </button>
              <button onClick={downloadPptx} style={{ background: 'var(--bg-card)', border: '1px solid var(--border)', borderRadius: '8px', padding: '8px 16px', color: 'var(--text-primary)', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '6px', fontSize: '13px' }}>
                <Icons.Download /> Download .pptx
              </button>
            </div>
          </div>

          {/* Stats Bar */}
          {stats && stats.length > 0 && (
            <div style={{ display: 'flex', gap: '12px', marginBottom: '16px', flexWrap: 'wrap' }}>
              {stats.slice(0, 4).map((stat, i) => (
                <div key={i} style={{ flex: '1 1 150px', background: 'var(--bg-card)', borderRadius: '8px', padding: '16px', border: '1px solid var(--border)', textAlign: 'center' }}>
                  <div style={{ fontSize: '24px', fontWeight: '700', color: 'var(--accent)', fontFamily: 'monospace' }}>{stat.value}</div>
                  <div style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '4px' }}>{stat.label}</div>
                </div>
              ))}
            </div>
          )}

          {/* Diagram */}
          {diagram && currentSlide === 0 && (
            <div style={{ background: 'var(--bg-card)', borderRadius: '12px', padding: '24px', border: '1px solid var(--border)', marginBottom: '16px', overflow: 'auto' }}>
              <div style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '2px', color: 'var(--text-secondary)', marginBottom: '12px' }}>Methodology Overview</div>
              <div ref={mermaidRef} className="mermaid" style={{ display: 'flex', justifyContent: 'center' }}></div>
            </div>
          )}

          {/* Main Slide */}
          <div style={{ background: 'var(--bg-card)', borderRadius: '16px', padding: '48px', border: '1px solid var(--border)', minHeight: '350px' }}>
            <div style={{ fontSize: '11px', color: 'var(--text-secondary)', marginBottom: '12px', textTransform: 'uppercase', letterSpacing: '2px' }}>
              Slide {currentSlide + 1} of {slides.length}
              {slide.section && <span style={{ marginLeft: '12px', color: 'var(--accent)' }}>• {slide.section}</span>}
            </div>
            <h4 className="serif" style={{ fontSize: '28px', marginBottom: '24px', color: 'var(--accent)' }}>{slide.title}</h4>
            <ul style={{ listStyle: 'none' }}>
              {slide.points.map((point, i) => (
                <li key={i} style={{ fontSize: '16px', lineHeight: '1.8', color: 'var(--text-secondary)', marginBottom: '12px', paddingLeft: '24px', position: 'relative' }}>
                  <span style={{ position: 'absolute', left: 0, color: 'var(--accent)' }}>→</span>
                  {point}
                </li>
              ))}
            </ul>
            {slide.stat && (
              <div style={{ marginTop: '24px', display: 'inline-block', background: 'var(--bg-secondary)', border: '1px solid var(--accent)', borderRadius: '8px', padding: '12px 20px' }}>
                <span style={{ color: 'var(--accent)', fontWeight: '700', fontSize: '18px' }}>{slide.stat}</span>
              </div>
            )}
            {slide.quiz && (
              <div style={{ marginTop: '24px', padding: '16px', background: 'var(--bg-secondary)', borderRadius: '8px', borderLeft: '3px solid var(--accent)' }}>
                <div style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '1px', color: 'var(--accent)', marginBottom: '8px' }}>Quick Check</div>
                <p style={{ color: 'var(--text-primary)', fontSize: '14px' }}>{slide.quiz}</p>
              </div>
            )}
          </div>

          {/* Speaker Notes */}
          {showNotes && slide.notes && (
            <div style={{ background: 'var(--bg-secondary)', borderRadius: '12px', padding: '20px', marginTop: '12px', border: '1px solid var(--border)' }}>
              <div style={{ fontSize: '11px', textTransform: 'uppercase', letterSpacing: '2px', color: 'var(--accent)', marginBottom: '8px' }}>Speaker Notes</div>
              <p style={{ color: 'var(--text-secondary)', fontSize: '14px', lineHeight: '1.6' }}>{slide.notes}</p>
            </div>
          )}

          {/* Navigation */}
          <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginTop: '20px', flexWrap: 'wrap' }}>
            {slides.map((_, i) => (
              <button
                key={i}
                onClick={() => setCurrentSlide(i)}
                style={{ width: i === currentSlide ? '32px' : '8px', height: '8px', borderRadius: '4px', background: i === currentSlide ? 'var(--accent)' : 'var(--border)', border: 'none', cursor: 'pointer', transition: 'all 0.2s' }}
              />
            ))}
          </div>
        </div>
      );
    }

    // ============ DECK SETTINGS ============
    function DeckSettings({ settings, setSettings, onGenerate, isGenerating }) {
      return (
        <div style={{ animation: 'fadeIn 0.4s ease' }}>
          <h3 className="serif" style={{ fontSize: '24px', marginBottom: '16px', color: 'var(--accent)' }}>Deck Settings</h3>
          <div style={{ background: 'var(--bg-card)', borderRadius: '16px', padding: '32px', border: '1px solid var(--border)' }}>
            
            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '10px', fontWeight: '600' }}>Number of Slides</label>
              <div style={{ display: 'flex', gap: '10px' }}>
                {[5, 10, 15].map(n => (
                  <button
                    key={n}
                    onClick={() => setSettings({ ...settings, depth: n })}
                    style={{ flex: 1, padding: '14px', background: settings.depth === n ? 'var(--accent)' : 'var(--bg-secondary)', border: '1px solid var(--border)', borderRadius: '8px', color: settings.depth === n ? 'var(--bg-primary)' : 'var(--text-primary)', cursor: 'pointer', fontWeight: settings.depth === n ? '600' : '400' }}
                  >
                    {n} slides
                  </button>
                ))}
              </div>
            </div>

            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '10px', fontWeight: '600' }}>Presentation Angle</label>
              <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                {[
                  { id: 'technical', label: 'Technical', desc: 'Methods & implementation' },
                  { id: 'business', label: 'Business', desc: 'Implications & applications' },
                  { id: 'general', label: 'General', desc: 'Accessible overview' }
                ].map(angle => (
                  <button
                    key={angle.id}
                    onClick={() => setSettings({ ...settings, angle: angle.id })}
                    style={{ flex: '1 1 150px', padding: '14px', background: settings.angle === angle.id ? 'var(--accent)' : 'var(--bg-secondary)', border: '1px solid var(--border)', borderRadius: '8px', color: settings.angle === angle.id ? 'var(--bg-primary)' : 'var(--text-primary)', cursor: 'pointer', textAlign: 'left' }}
                  >
                    <div style={{ fontWeight: '600' }}>{angle.label}</div>
                    <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>{angle.desc}</div>
                  </button>
                ))}
              </div>
            </div>

            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                <input
                  type="checkbox"
                  checked={settings.includeDiagram}
                  onChange={(e) => setSettings({ ...settings, includeDiagram: e.target.checked })}
                  style={{ width: '20px', height: '20px', accentColor: 'var(--accent)' }}
                />
                <span>Include methodology diagram</span>
              </label>
            </div>

            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer' }}>
                <input
                  type="checkbox"
                  checked={settings.includeQuiz}
                  onChange={(e) => setSettings({ ...settings, includeQuiz: e.target.checked })}
                  style={{ width: '20px', height: '20px', accentColor: 'var(--accent)' }}
                />
                <span>Add quiz questions to slides</span>
              </label>
            </div>

            <button
              onClick={onGenerate}
              disabled={isGenerating}
              style={{ width: '100%', padding: '16px', background: 'var(--accent)', border: 'none', borderRadius: '8px', color: 'var(--bg-primary)', cursor: 'pointer', fontWeight: '600', fontSize: '16px', opacity: isGenerating ? 0.7 : 1, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}
            >
              {isGenerating ? (
                <>
                  <div style={{ width: '18px', height: '18px', border: '2px solid var(--bg-primary)', borderTopColor: 'transparent', borderRadius: '50%', animation: 'spin 1s linear infinite' }} />
                  Generating...
                </>
              ) : (
                <>
                  <Icons.Slides /> Generate Deck
                </>
              )}
            </button>
          </div>
        </div>
      );
    }

    // ============ RESULTS COMPONENT ============
    function Results({ data, apiKey, paperText }) {
      const [activeTab, setActiveTab] = useState('summary');
      const [deckData, setDeckData] = useState(null);
      const [deckSettings, setDeckSettings] = useState({ depth: 10, angle: 'general', includeDiagram: true, includeQuiz: true });
      const [isGeneratingDeck, setIsGeneratingDeck] = useState(false);

      const tabs = [
        { id: 'summary', label: 'Summary', icon: <Icons.FileText /> },
        { id: 'flashcards', label: 'Flashcards', icon: <Icons.Cards /> },
        { id: 'audio', label: 'Audio', icon: <Icons.Play /> },
        { id: 'deck', label: 'Deck', icon: <Icons.Slides /> }
      ];

      const generateDeck = async () => {
        setIsGeneratingDeck(true);
        try {
          const anglePrompts = {
            technical: 'Focus on methodology, algorithms, implementation details, and technical innovations.',
            business: 'Focus on business implications, market applications, competitive advantages, and ROI potential.',
            general: 'Focus on making concepts accessible to a general audience with clear explanations.'
          };

          const prompt = `Create a ${deckSettings.depth}-slide learning deck from this research paper.
${anglePrompts[deckSettings.angle]}

Structure the deck with this story arc:
1. Problem/Context (why this matters)
2. Background (what exists today)
3. Approach (what's new)
4. Key Methods/Architecture
5. Results
6. Implications (so what?)

For EACH slide, provide:
- "section": which part of story arc
- "title": clear slide title
- "points": array of 3-4 bullet points
- "stat": one key statistic if relevant (optional)
- "notes": what the presenter should say (2-3 sentences)
${deckSettings.includeQuiz ? '- "quiz": one comprehension question for this slide' : ''}

Also extract:
- "stats": array of {value, label} for 3-4 key metrics from the paper
${deckSettings.includeDiagram ? '- "diagram": a Mermaid flowchart showing the methodology (use graph TD syntax)' : ''}

Research Paper:
${paperText.slice(0, 25000)}

Return ONLY valid JSON with this structure:
{
  "slides": [...],
  "stats": [...],
  "diagram": "graph TD\\n  A[Input] --> B[Process]\\n  B --> C[Output]"
}`;

          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              generationConfig: { temperature: 0.7, maxOutputTokens: 8192 }
            })
          });

          const result = await response.json();
          const text = result.candidates[0].content.parts[0].text;
          const jsonMatch = text.match(/\{[\s\S]*\}/);
          const parsed = JSON.parse(jsonMatch[0]);
          
          setDeckData(parsed);
        } catch (err) {
          console.error('Deck generation error:', err);
          alert('Failed to generate deck. Please try again.');
        } finally {
          setIsGeneratingDeck(false);
        }
      };

      return (
        <div style={{ marginTop: '32px', animation: 'fadeIn 0.5s ease' }}>
          <TabNav activeTab={activeTab} setActiveTab={setActiveTab} tabs={tabs} />
          
          {activeTab === 'summary' && <Summary content={data.summary} />}
          {activeTab === 'flashcards' && <Flashcards cards={data.flashcards} />}
          {activeTab === 'audio' && <AudioPlayer text={data.audioScript} title={data.title} />}
          {activeTab === 'deck' && (
            deckData ? (
              <EnhancedDeck slides={deckData.slides} title={data.title} diagram={deckData.diagram} stats={deckData.stats} />
            ) : (
              <DeckSettings settings={deckSettings} setSettings={setDeckSettings} onGenerate={generateDeck} isGenerating={isGeneratingDeck} />
            )
          )}
        </div>
      );
    }

    // ============ MAIN APP ============
    function App() {
      const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
      const [isProcessing, setIsProcessing] = useState(false);
      const [status, setStatus] = useState('');
      const [results, setResults] = useState(null);
      const [paperText, setPaperText] = useState('');
      const [error, setError] = useState('');

      const extractTextFromPDF = async (file) => {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let text = '';
        for (let i = 1; i <= Math.min(pdf.numPages, 50); i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          text += content.items.map(item => item.str).join(' ') + '\n';
        }
        return text;
      };

      const fetchArxivPaper = async (url) => {
        // Extract arxiv ID and construct PDF URL
        const match = url.match(/arxiv\.org\/(abs|pdf)\/([0-9.]+)/);
        if (!match) throw new Error('Invalid arXiv URL');
        
        const arxivId = match[2];
        const pdfUrl = `https://export.arxiv.org/pdf/${arxivId}.pdf`;
        
        // We can't directly fetch the PDF due to CORS, so we'll use the abstract page
        const abstractUrl = `https://export.arxiv.org/abs/${arxivId}`;
        
        setStatus('Note: For arXiv papers, please download the PDF and upload it directly for best results.');
        throw new Error('Direct arXiv fetching is limited by browser security. Please download the PDF from arXiv and upload it.');
      };

      const callGemini = async (prompt) => {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: { temperature: 0.7, maxOutputTokens: 8192 }
          })
        });

        if (!response.ok) {
          const err = await response.json();
          throw new Error(err.error?.message || 'API request failed');
        }

        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
      };

      const processFile = async (file) => {
        if (!apiKey) {
          setError('Please enter your Gemini API key first');
          return;
        }

        setIsProcessing(true);
        setError('');
        setResults(null);

        try {
          setStatus('Extracting text from PDF...');
          const pdfText = await extractTextFromPDF(file);
          setPaperText(pdfText);
          const truncatedText = pdfText.slice(0, 30000);

          setStatus('Generating summary...');
          const summaryPrompt = `Analyze this research paper and provide a clear, concise 250-word summary that captures:
1. The main problem being addressed
2. The key methodology or approach
3. The most important findings
4. Why this matters

Write in plain language accessible to an educated general audience.

Research Paper:
${truncatedText}

Provide only the summary, no additional text or formatting.`;
          
          const summary = await callGemini(summaryPrompt);

          setStatus('Creating flashcards...');
          const flashcardsPrompt = `Create exactly 25 flashcards from this research paper. Each flashcard should test understanding of:
- Key concepts and definitions
- Methodology details
- Important findings and numbers
- Implications and applications

Research Paper:
${truncatedText}

Return ONLY a valid JSON array with exactly 25 objects. Each object must have "question" and "answer" keys.
Format: [{"question": "...", "answer": "..."}]
No markdown, no explanation, just the JSON array.`;
          
          const flashcardsRaw = await callGemini(flashcardsPrompt);
          let flashcards;
          try {
            const jsonMatch = flashcardsRaw.match(/\[[\s\S]*\]/);
            flashcards = JSON.parse(jsonMatch ? jsonMatch[0] : flashcardsRaw);
          } catch {
            flashcards = Array(25).fill(null).map((_, i) => ({
              question: `Key concept ${i + 1} from the paper?`,
              answer: "Please regenerate the flashcards."
            }));
          }

          setStatus('Preparing audio script...');
          const audioPrompt = `Create an engaging audio script summarizing this research paper. Write it as if you're explaining the paper to a curious friend over coffee. Make it conversational, clear, and interesting. About 400 words.

Research Paper:
${truncatedText}

Provide only the script, optimized for spoken delivery. No stage directions or speaker labels.`;
          
          const audioScript = await callGemini(audioPrompt);

          const title = file.name.replace('.pdf', '').replace(/_/g, ' ');

          setResults({
            title,
            summary,
            flashcards: flashcards.slice(0, 25),
            audioScript
          });

        } catch (err) {
          console.error(err);
          setError(err.message || 'An error occurred while processing the paper');
        } finally {
          setIsProcessing(false);
          setStatus('');
        }
      };

      const handleArxivSubmit = async (url) => {
        try {
          setIsProcessing(true);
          await fetchArxivPaper(url);
        } catch (err) {
          setError(err.message);
        } finally {
          setIsProcessing(false);
        }
      };

      return (
        <div style={{ maxWidth: '900px', margin: '0 auto', padding: '40px 20px', minHeight: '100vh' }}>
          <header style={{ textAlign: 'center', marginBottom: '48px' }}>
            <h1 className="serif" style={{ fontSize: '48px', marginBottom: '12px', background: 'linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>
              PaperMind
            </h1>
            <p style={{ color: 'var(--text-secondary)', fontSize: '18px', maxWidth: '500px', margin: '0 auto' }}>
              Transform research papers into learning materials
            </p>
          </header>

          <ApiKeyInput apiKey={apiKey} setApiKey={setApiKey} />
          
          <FileUpload onFileSelect={processFile} onArxivSubmit={handleArxivSubmit} isProcessing={isProcessing} />

          {error && (
            <div style={{ background: 'rgba(200, 60, 60, 0.1)', border: '1px solid rgba(200, 60, 60, 0.3)', borderRadius: '12px', padding: '16px', marginBottom: '24px', color: '#ff6b6b' }}>
              {error}
            </div>
          )}

          {isProcessing && <ProcessingStatus status={status} />}

          {results && <Results data={results} apiKey={apiKey} paperText={paperText} />}

          <footer style={{ textAlign: 'center', marginTop: '64px', paddingTop: '24px', borderTop: '1px solid var(--border)', color: 'var(--text-secondary)', fontSize: '13px' }}>
            Your API key is stored locally and never sent to any server except Google's Gemini API.
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
